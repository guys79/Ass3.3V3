<!DOCTYPE html>
<html  ng-app = "myApp">
<!--Create all the images using addCustomImage-->
<head>
    <title>Guy and Jonathan's POI</title>
    <style>
        #header
        {
            background-color: #485864;
            text-align: center;
            
        }
        #header_list
        {
            background-color: #485864;
            text-align: center;
        }
        #authors
        {
            background-color: #485864;
            text-align:inherit;
            margin-right: 25%;
        }
      
    </style>
    <header id="header">
            <ul id="header_list">
                    <li id="authors">
                            <h4>
                                <p><b>Authors:</b> Guy Schlesinger - 207232885 
                                <br/>& Jonathan Shaya - 318530706
                            </h4></li>
                    <li><a><img src="source/logo.jpg" width= "400" height="125" id="logo"></a></li>
                    <h4>
                            <h1 id="hello">hello </h1>
                           
                        </h4></li>
        
            </ul>

        


        
    </header>
    
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-route.min.js"></script>
    <script src="javascript/jquery-3.4.0.min.js"></script>
    <script src="javascript/jquery.validate.js"></script>
    <script src="javascript/validate_sign_up.js" language="JavaScript"></script>
    
    <script>
    </script>

    <script type="text/javascript">

        window.addEventListener("load",Initialize);
     
        var current;
        var firstCategory = true;
        var modalPoi = "";
        var random3 = "guy";
        var isRegisterValid = false;
        var first = true;
        var loginPhotos = [];
        const app = angular.module('myApp', ['ngRoute']);
        app.controller('loginCtrl', function($scope, $http) {
            $scope.autoLogin = function (token)
            {
                $http({
                        method:"POST",
                        url : "http://localhost:3000/private",
                        headers: {"x-auth-token":token}
                }).then(function mtSuccess(response)
                {
                    if(response.data["result"] === "valid token" )
                    {
                        
                        current = new Object();
                        current.username = response.data["username"]
                        whenLoggin();
                    }
                }
                )
            }
            $scope.login = function(username,password)
            {
               
                    $http({
                        method:"POST",
                        url : "http://localhost:3000/login",
                        data: {username:username, password:password}

                    }).then(function (response)
                    {

                        window.sessionStorage.setItem("token",response.data["token"]);
                        window.sessionStorage.removeItem("favorite",response.data["token"]);
                        var errorLabel = document.getElementById('errors_login');
                        errorLabel.innerText = "";
                        current = new Object();
                        current.username = username;

                        whenLoggin();
                    },
                    function (response)
                    {
                        
                        var errorMessage = "Wrong username or password, please try again";
                        var errorLabel = document.getElementById('errors_login');  
                        errorLabel.innerText = errorMessage;  
                    }
                    
                    );
            
                
            }
            $http({
                method : "GET",
                url : "http://localhost:3000/GetRandomPopularPOI"
                }).then(function mySuccess(response) {
                    
                    $scope.Explore = "Explore";

                    for(var i=0;i<response.data.length;i++)
                    {
                        loginPhotos[response.data[i]["poiName"]]=response.data[i]["pictureName"];
                    }
                    addLoginPhotosNoParams();
                    
                    }, function myError(response) {
                        
                    
                    $scope.Explore = "Explore"
                    
                });
            
            });
            app.controller('customCtrl', function($scope, $http) {
                $scope.checkIfFavorite =  function(username,id,image)
                {
                    var idNew = id;
                        if(id.substring(id.length-3) === "poi")
                        {
                            idNew = id.substring(0,id.length-3)
                        }
                        else
                        {
                            if(id.substring(id.length-4) === "pois" || id.substring(id.length-4) === "poir")
                            {
                                idNew = id.substring(0,id.length-4)
                            }   
                        }
                    var newId = idNew;
                    while(newId.indexOf(" ")!=-1)
                    {
                        newId = newId.replace(" ","+");
                    }
                    if(checkIfFavoriteLocal(idNew))
                    {
                        image.src = "source/checked.png";
                    }
                    else
                    {
                        $http({
                    
                            method : "GET",
                            url : "http://localhost:3000/CheckIfFavorite?username="+username+"&poiName="+newId
                            }).then(function mySuccess(response) {
                                
                            if(response.data)
                            {
                                    image.src = "source/checked.png";
                            }
                                
                            });
                    }
                }
            
            });
            app.controller('personalCtrl',function($scope,$http)
                {
                    $scope.getNumberOfFavorites = function(username)
                    {
                        $http({
                            method: "GET",
                            url:"http://localhost:3000/GetFavoritesCount?username="+username
                        }).then(function mySuccess(response)
                        {
                            numberOfFavorites = parseInt(response.data[0][""])
                            
                        },function mtFailure(response)
                        {

                        }
                        );
                        
                        
                    }
                    $scope.displayPersonalImage = function(username)
                    {
                        
                        
                        //get saved
                        $http({
                            method : "GET",
                            url : "http://localhost:3000/GetAllFavoritesPOIs?username="+username
                            
                            }).then(
                                function mySuccess(response)
                                {
                                    var saved = []
                                  
                                    var favorites = window.sessionStorage.getItem("favorite");
                                    if(favorites === null)
                                        {
                                            favorites = "";
                                    
                                            for(var i=0;i<response.data.length;i++)
                                            {
                                                for(var j=0;j<response.data.length;j++)
                                                {
                                                    if(parseInt(response.data[j]["position"]) == i)
                                                    {
                                                        saved.push(response.data[j]["poiName"]);
                                                        
                                                        favorites = favorites + response.data[j]["poiName"]+"?"+response.data[j]["position"]+",";
                                                    }
                                                }
                                            }
                                            favorites = favorites.substring(0,favorites.length-1)
                                        }
                                    else
                                    {
                                        numberOfFavorites = response.data.length;
                                        var localFavoriteNames = getLocalFavorites();
                                        for(var i=0;i<localFavoriteNames.length;i++)
                                        {

                                            saved.push(getIdByPositionLocal(i));

                                        }
                                        
                                      
                                    }
                                    
                                    $http({
                                            method: "GET",
                                            url: "http://localhost:3000/GetAllPOIs"
                                        }).then(function mySuccess(response) {

                                                var savedWithSrc = [];
                                                for(var i=0;i<saved.length;i++)
                                                {
                                                    for(var j=0;j<response.data.length;j++)
                                                        {
                                                            if(checkedSort_personal)
                                                            {
                                                                if(response.data[j]["poiName"] === saved[i])
                                                                  savedWithSrc.push({"id":saved[i],"src":response.data[j]["pictureName"],"rank":response.data[j]["score"]});
                                                            }
                                                            else
                                                            {
                                                                if(isFiltered_personal)
                                                                {
                                                                    if(response.data[j]["poiName"] === saved[i])
                                                                        savedWithSrc.push({"id":saved[i],"src":response.data[j]["pictureName"],"category":response.data[j]["category"]});
                                                                }
                                                                else
                                                                {
                                                                    if(response.data[j]["poiName"] === saved[i])
                                                                        savedWithSrc.push({"id":saved[i],"src":response.data[j]["pictureName"]});
                                                                }
                                                            }
                                                            
                                                            
                                                        }
                                                    
                                                }

                                            //get Recommended
                                            $http({
                                                method : "GET",
                                                url : "http://localhost:3000/PopularPOIFromTopic?username="+username
    
                                                    }).then(
                                                        function mySuccess(response)
                                                        {
                                                            //here
                                                            console.log("username!!!! "+username)
                                                            var recommded = []
                                                            if(!checkedSort_personal)
                                                            {
                                                                if(isFiltered_personal)
                                                                {
                                                                    recommded.push({"id":response.data[0]["poiName"],"src":response.data[0]["pictureName"],"category":response.data[0]["category"]});
                                                                    recommded.push({"id":response.data[1]["poiName"],"src":response.data[1]["pictureName"],"category":response.data[1]["category"]});
                                                                }
                                                                else
                                                                {
                                                                    recommded.push({"id":response.data[0]["poiName"],"src":response.data[0]["pictureName"]});
                                                                    recommded.push({"id":response.data[1]["poiName"],"src":response.data[1]["pictureName"]});
                                                                }
                                                                
                                                            }
                                                            else
                                                            {
                                                                recommded.push({"id":response.data[0]["poiName"],"src":response.data[0]["pictureName"],"rank":response.data[0]["score"]});
                                                                recommded.push({"id":response.data[1]["poiName"],"src":response.data[1]["pictureName"],"rank":response.data[1]["score"]});
                                                            }
                                                            //get Recommended
                                                            var array = []
                                                            array.push(savedWithSrc);
                                                            array.push(recommded);
                                                            //Filter here
                                                            //delete the selection and treat the filter as a button to sort by category
                                                          
                                                            if(checkedSort_personal || isFiltered_personal)
                                                            {
                                                                var type = "category";
                                                                if(checkedSort_personal)
                                                                {
                                                                    type = "rank";
                                                                
                                                               
                                                                    
                                                                    var pointOfInterestArray = array;
                                                                    //sort here
                                                                
                                                                    var min = 6;
                                                                
                                                                    var index = 0;
                                                                    var startIndex = 0;
                                                                    var j = 0;
                                                                    for(var i=0;i<pointOfInterestArray.length;i++)
                                                                    {
                                                                        startIndex = 0;
                                                                        while(pointOfInterestArray[i].length > startIndex) {
                                                                            j = startIndex;
                                                                            index = j;
                                                                            min = 6;
                                                                            for (j = startIndex; j < pointOfInterestArray[i].length; j++) {
                                                                                if (parseFloat(pointOfInterestArray[i][j][type]) < min) {
                                                                                    min = parseFloat(pointOfInterestArray[i][j][type])
                                                                                    index = j;
                                                                                }

                                                                            }
                                                                            
                                                                            switchPlacesPersonal(pointOfInterestArray, i, startIndex, index)
                                                                            startIndex++;
                                                                        }
                                                                    }
                                                                }
                                                                if(!checkedSort_personal)
                                                                {
                                                                    var pointOfInterestArray = array;
                                                                    //sort here
                                                                
                                                                    var min = "zzzzzzzzzzzzzzzzzzzzzzzzz";
                                                                
                                                                    var index = 0;
                                                                    var startIndex = 0;
                                                                    var j = 0;
                                                                    for(var i=0;i<pointOfInterestArray.length;i++)
                                                                    {
                                                                        startIndex = 0;
                                                                        while(pointOfInterestArray[i].length > startIndex) {
                                                                            j = startIndex;
                                                                            index = j;
                                                                            min = "zzzzzzzzzzzzzzzzzzzzzzzzz";
                                                                            for (j = startIndex; j < pointOfInterestArray[i].length; j++) {
                                                                                if (pointOfInterestArray[i][j][type].localeCompare(min)<0) {
                                                                                    min = pointOfInterestArray[i][j][type]
                                                                                    index = j;
                                                                                }

                                                                            }
                                                                            
                                                                            switchPlacesPersonal(pointOfInterestArray, i, startIndex, index)
                                                                            startIndex++;
                                                                        }
                                                                    }
                                                                    
                                                                }
                                                                //convert back
                                                                array = pointOfInterestArray;
                                                                var newArr = [];
                                                                //var favorites = "";
                                                                for(var i=0;i<array.length;i++)
                                                                {
                                                                    
                                                                    var temp = [];
                                                                    for(var j=0;j<array[i].length;j++)
                                                                    {
                                                                        temp.push({"id":array[i][j]["id"],"src":array[i][j]["src"]});
                                                                        

                                                                    }
                                                                    newArr.push(temp);
                                                                }
                                                                array = newArr;
                                                            }
                                                            window.sessionStorage.setItem("favorite",favorites);
                                                            displayPhotosPersonal(array);
                                                        },
                                                        function myFailure(response)
                                                        {

                                                        }
                                                    )
                                                
                                },
                                function myFailure(response)
                                {

                                })



                                        }, function myFailure(response)
                                        {

                                        })
                                    
                        
                       

                    }
                    $scope.uploadFavorite= function (username,id,position)
                    {
                            var givenId = id;
                            while(id.indexOf(" ")!=-1)
                            {
                                id= id.replace(" ","+");
                            }
                        
                            $http({
                                method: "GET",
                                url : "http://localhost:3000/GetFavoritePosition?username="+username+"&poiName="+id
                        
                                }).then(function mySuccess(response)
                                    {
                                        //Wasn't in favorites
                                        if(response.data.length == 0)
                                        {
                                            $http({
                                                method: "POST",
                                                url : "http://localhost:3000/savePoi",
                                                data: {username:username,poiName:givenId,position:position}
                                        
                                                }).then(function mySuccess(response)
                                                {
                                                    
                                                        document.getElementById("upload_btn").value = "Uploaded successfully!"
                                                        
                                                })
                                        }
                                        else
                                        {
                                            //only  update the location
                                            $http({
                                            method: "PUT",
                                                url : "http://localhost:3000/UpdateFavoritesListOrder",
                                                data: {username:username,poiname:givenId,position:position}
                                            }).then(function mySuccess(response)
                                            {
                                                document.getElementById("upload_btn").value = "Uploaded successfully!"
                                                
                                            });
                                        }
                                    }
                                )

                    }
                    $scope.removeFavorite = function(username,poiId)
                    {
                        var id = poiId;
                        var idNew = id;
                        if(id.substring(id.length-3) === "poi")
                        {
                            idNew = id.substring(0,id.length-3)
                        }
                        else
                        {
                            if(id.substring(id.length-4) === "pois" || id.substring(id.length-4) === "poir")
                            {
                                idNew = id.substring(0,id.length-4)
                            }   
                        }
                        id = idNew;
                            while(id.indexOf(" ")!=-1)
                            {
                                id= id.replace(" ","+");
                            }
                        $http({
                                method: "GET",
                                url : "http://localhost:3000/CheckIfFavorite?username="+username+"&poiName="+id
                        
                                }).then(function mySuccess(response)
                                {
                                    var favorites = window.sessionStorage.getItem("favorite");
                                        if(response.data)
                                        {
                                            $http({
                                                method: "DELETE",
                                                url : "http://localhost:3000/RemovePOI?username="+username+"&poiName="+id
                                                
                                                }).then(function mySuccess(response)
                                                {
                                                    $http({
                                                        method : "GET",
                                                        url : "http://localhost:3000/GetAllFavoritesPOIs?username="+username
                                                        
                                                        }).then(function mySuccess(response)
                                                        {
                                                            var missing = true;
                                                            var pos =-1;
                                                            for(var i=0;i<response.data.length&&missing;i++)
                                                            {
                                                                missing = false;
                                                                pos = i;
                                                                for(var j=0;j<response.data.length;j++)
                                                                {
                                                                    
                                                                    if(parseInt(response.data[j]["position"]) == i)
                                                                    {
                                                                        missing =true;
                                                                        
                                                                    }
                                                                }
                                                            }
                                                 
                                                            if(!missing)
                                                            {
                                                             
                                                                //Need to update pos
                                                                for(var i=pos+1;i<response.data.length+1;i++)
                                                                {
                                                                    for(var j=0;j<response.data.length;j++)
                                                                    {
                                                                      
                                                                        if(parseInt(response.data[j]["position"]) == i)
                                                                        {
                                                                           
                                                                            favorites = favorites.replace(response.data[j]["poiName"]+"?"+i,response.data[j]["poiName"]+"?"+(i-1));
                                                                       
                                                                        }
                                                                    }
                                                                    for(var j=0;j<response.data.length;j++)
                                                                    {
                                                                        
                                                                        if(parseInt(response.data[j]["position"]) == i)
                                                                        {
                                                                                
                                                                            $http({
                                                                            method: "PUT",
                                                                                url : "http://localhost:3000/UpdateFavoritesListOrder",
                                                                                data: {username:current.username,poiname:response.data[j]["poiName"],position:""+(i-1)}
                                                                            }).then(function mySuccess(response)
                                                                            {
                                                                              
                                                                            });
                                                                            
                                                                        }
                                                                    }
                                                                }
                                                                
                                                            }
                                                            removeFromLocal(favorites,idNew);
                                                        });
                                                    });
                                                }
                                               
                                        
                                        else
                                        {
                                          removeFromLocal(favorites,idNew)
                                        } 
                                                
                                });   
                        
                    }
                }
                
            );
        app.controller('modalCtrl',function($scope,$http)
            {
                $scope.saveReview = function(given_text,num,poiID,given_username)
                {
                    $http({
                    method: "POST",
                    url:"http://localhost:3000/poiFeedback",
                    data: {username:given_username, 
                        text:given_text,
                        score:num,
                        poiName:poiID
                    }

                    }).then(function mySuccess(response)
                        {
                            
                            var id = poiID;
                            while(id.indexOf(" ")!=-1)
                            {
                                id= id.replace(" ","+");
                            }
                            $http({
                                method: "GET",
                                url : "http://localhost:3000/GetFeedbacksPOI?id="+id
                        
                                }).then(function mySuccess(response)
                                    {
                                        
                                        //Update rank
                                        var sum=0;
                                        for(var i=0;i<response.data.length;i++)
                                        {
                                            var single_score = parseFloat(response.data[i]["score"]);
                                            
                                            sum = sum +single_score;    
                                        }
                                        var Rank=0;
                                        if(response.data.length!=0)
                                        {
                                            var score = sum*1.0;
                                            score= score /response.data.length;
                                            
                                            score = Math.round(score * 100) / 100
                                            Rank = score;
                                        }
                                        $http({
                                                method: "PUT",
                                                url : "http://localhost:3000/UpdatePOIRank",
                                                data:{rank: ""+Rank, poiName:poiID}
                                                
                                    
                                            }).then(function nySuccess(response)
                                                {
                                                    
                                                }, function myFailure(response)
                                                {

                                                }
                                            );
                                    },
                                    function myFailure(response)
                                    {
                                        
                                    }
                                );
                            GoTo(prevSection);
                        },
                        function myFailure(response)
                        {
                            
                        }
                    )
                }
               

            }
        );
        app.controller('restoreCtrl',function($scope,$http)
        {
            $scope.getQuestions= function(username)
            {
                $http({
                        method : "GET",
                        url : "http://localhost:3000/GetUserQuestions?username="+username
                    }).then(
                        function mySuccess(response)
                        {  
                            //set questions
                            var question = document.getElementById("select_question");
                            for(var i=0;i<response.data.length;i++)
                            {
                                var option = document.createElement("option");
                                option.text = response.data[i]["question"];
                                question.add(option);
                            }
                        },
                        function myFailure(response)
                        {  
                        }
                    )
            }

            $scope.checkAnswer = function(given_username,given_question,given_answer)
            {
                
                $http({
                    method: "POST",
                    url:"http://localhost:3000/restorePassword",
                    data: {username:given_username, question:given_question,answer:given_answer}

                }).then(function mySuccess(response)
                {
                    
                    var password = response.data["message"];
                    if(response.data.length == 0)
                    {
                        $scope.error = "The answer was not correct";
                        
                    }
                    else
                    {
                        $scope.error = "The password is "+password;
                    }
                    document.getElementById("errors_restore").hidden = false;
                },
                function myFailure(response)
                {
                    $scope.error = "The answer was not correct";
                    document.getElementById("errors_restore").hidden = false;
                }
                )
            }

        });
        app.controller('getPOI', function ($scope, $http) {

            $scope.getCategories = function (category) {
                $http({
                    method: "GET",
                    url: "http://localhost:3000/GetAllPOIs"
                }).then(function mySuccess(response) {
                    if(firstCategory)
                    {
                        var categories = document.getElementById('select_category_filter');
                        
                        var set = new Set([]);
                        //categories
                        for(var i=0; i<response.data.length;i++)
                        {
                            set.add(response.data[i]["category"]);
                            
                        }
                        for (let item of set)
                        {
                            var option = document.createElement("option");
                            option.text = item;
                            categories.add(option);
                          
                        }
                        firstCategory = false;
                    }

                    var pointOfInterestArray = {};
                    var arrP1 = [];
                    var arrP2 = [];
                    var arrP3 = [];
                    var arrP4 = [];
                  
                  
                    for (var i = 0; i < response.data.length; i++) {
                        if (response.data[i]["category"].localeCompare("museum") === 0) {
                            arrP1.push(response.data[i]);
                            
                        }
                        if (response.data[i]["category"].localeCompare("religious sites") === 0) {
                            arrP2.push(response.data[i]);
                            
                        }
                        if (response.data[i]["category"].localeCompare("historical site") === 0) {
                            arrP3.push(response.data[i]);
                            
                        }
                        if (response.data[i]["category"].localeCompare("attractions") === 0) {
                            arrP4.push(response.data[i]);
                        
                        }
                    }
                    
                    pointOfInterestArray["museum"] = arrP1;
                
                    pointOfInterestArray["religious sites"] = arrP2;

                    pointOfInterestArray["historical site"] = arrP3;
            
                    pointOfInterestArray["attractions"] = arrP4;

                    if (isFiltered && category != "") {
                        filterByCategory(pointOfInterestArray, category);
                       
                    }
                    else {
                        noFilter(pointOfInterestArray);
                    }
                    });
            }

            $scope.getRanks = function (bool, pointOfInterestArray2) {
                type = "score";
                if (bool || !bool && type.localeCompare("score")===0) {
                        
                        var pointOfInterestArray={};
                        var arrP1 = [];
                        var arrP2 = [];
                        var arrP3 = [];
                        var arrP4 = [];
                        var arrV1 = [];
                        var arrV2 = [];
                        var arrV3 = [];
                        var arrV4 = [];
                        
                        var categoryRank = {};
                        
                            if (typeof pointOfInterestArray2["museum"] != 'undefined') {
                                for(var i=0;i<pointOfInterestArray2["museum"].length;i++)
                                {
                                    arrP1.push({"src" : pointOfInterestArray2["museum"][i]["pictureName"], "id" : pointOfInterestArray2["museum"][i]["poiName"]});
                                    arrV1.push(pointOfInterestArray2["museum"][i][type]);
                                }

                                pointOfInterestArray["museum"] = arrP1;
                                categoryRank["museum"] = arrV1;
                            }
                            if (typeof pointOfInterestArray2["religious sites"] != 'undefined') {
                                for(var i=0;i<pointOfInterestArray2["religious sites"].length;i++)
                                {
                                    arrP2.push({"src" : pointOfInterestArray2["religious sites"][i]["pictureName"], "id" : pointOfInterestArray2["religious sites"][i]["poiName"]});
                                    arrV2.push(pointOfInterestArray2["religious sites"][i][type]);
                                }
                                pointOfInterestArray["religious sites"] = arrP2;
                                categoryRank["religious sites"] = arrV2;
                            }
                            if (typeof pointOfInterestArray2["historical site"] != 'undefined') {
                                for(var i=0;i<pointOfInterestArray2["historical site"].length;i++)
                                {
                                    arrP3.push({"src" : pointOfInterestArray2["historical site"][i]["pictureName"], "id" : pointOfInterestArray2["historical site"][i]["poiName"]});
                                    arrV3.push(pointOfInterestArray2["historical site"][i][type]);
                                }
                                pointOfInterestArray["historical site"] = arrP3;
                                categoryRank["historical site"] = arrV3;
                            }
                            if (typeof pointOfInterestArray2["attractions"] != 'undefined') {
                                for(var i=0;i<pointOfInterestArray2["attractions"].length;i++)
                                {
                                    arrP4.push({"src" : pointOfInterestArray2["attractions"][i]["pictureName"], "id" : pointOfInterestArray2["attractions"][i]["poiName"]});
                                    arrV4.push(pointOfInterestArray2["attractions"][i][type]);
                                }
                                pointOfInterestArray["attractions"] = arrP4;
                                categoryRank["attractions"] = arrV4;
                            }
                           
                      
                        var min = 6;
                        var index = 0;
                        var startIndex = 0;
                        var j = 0;
                        for (category in pointOfInterestArray) {
                            startIndex = 0;
                            while(pointOfInterestArray[category].length > startIndex) {
                                j = startIndex;
                                index = j;
                                min = 6;
                                for (j = startIndex; j < pointOfInterestArray[category].length; j++) {
                                    if (categoryRank[category][j] < min) {
                                        min = categoryRank[category][j];
                                        index = j;
                                    }

                                }
                                var temp = categoryRank[category][startIndex];
                                categoryRank[category][startIndex] = categoryRank[category][index];
                                categoryRank[category][index] = temp;
                                switchPlaces(pointOfInterestArray, category, startIndex, index)
                                startIndex++;
                            }
                        }
                        displayPhotos(pointOfInterestArray)
                  
                }
                
            }
            });
            app.controller('singleCtrl', function($scope, $http) {
                $scope.getDetailed=function(givenId)
                {
                    var id = givenId;
                    while(id.indexOf(" ")!=-1)
                    {
                        id= id.replace(" ","+");
                    }
                 
                    $http({
                        method : "GET",
                        url : "http://localhost:3000/DetailedPOI?id="+id
                        }).then(function mySuccess(response) {
                            if(response.data.length>0)
                                {
                                $scope.Name = response.data[0]["poiName"];
                                $scope.Viewrs = "Number of Viewers: " + response.data[0]["views"];
                                
                                var score = parseFloat(response.data[0]["score"]);
                                score = (score-1)/4.0;
                                score = score * 100;
                                $scope.Rank = "Rank: "+score+"%";
                                var titleDes = document.getElementById("descriptionH4");
                                var description = "";
                                var temp = response.data[0]["description"];
                                var split = temp.split(" ");
                                for(var i=0;i<split.length;i++)
                                {
                                    description = description + " "+split[i];
                                    if(i%13==12)
                                        description = description +"</br>";
                                }
                                titleDes.innerHTML = "Description: "+ description;

                                
                                var src = response.data[0]["pictureName"];
                                var singleImage = document.getElementById("singlePhotoImage");
                                singleImage.src = src;
                                $http({
                                    method : "GET",
                                    url : "http://localhost:3000/GetFeedbacksPOI?id="+id
                                    }).then(function mySuccess(response) {
                                        if(response.data.length<2)
                                        {
                                            $scope.Review2 = "";
                                            if(response.data.length==0)
                                            {
                                                $scope.Review1 = "No reviews available";
                                                
                                            }
                                            else
                                            {
                                                $scope.Review1 = "Review 1: username - "+response.data[0]["username"] +", rank - "+response.data[0]["score"]
                                                + ", comment:\n"+response.data[0]["text"];

                                            }
                                        }
                                        else
                                        {
                                            $scope.Review1 = "Review 1: username - "+response.data[0]["username"] +", rank - "+response.data[0]["score"]
                                                + ", comment:\n"+response.data[0]["text"];
                                                $scope.Review2 = "Review 2: username - "+response.data[1]["username"] +", rank - "+response.data[1]["score"]
                                                + ", comment:\n"+response.data[1]["text"];
                                        }
                                        
                                
                                
                                
                                        
                                        
                                    })
                                }
                                else
                                {
                                    $scope.Name = "No Results Were Found For '"+givenId+"'";
                                    var singleImage = document.getElementById("singlePhotoImage");
                                    singleImage.src = "source/noRes.png";
                                    $scope.Viewrs = "";
                                    $scope.Rank = "";
                                    var titleDes = document.getElementById("descriptionH4");
                                    titleDes.innerHTML = "";
                                    $scope.Review1="";
                                    $scope.Review2="";
                                }

                              GoTo('singlePhoto');
                              document.getElementById("search_menu_txt").value = "";

                              $http({
                                  method: "PUT",
                                  url:"http://localhost:3000/AddViewPOI",
                                  data: {poiName:id}

                              }).then(function mySuccess(response)
                              {
                                  console.log("VIEW ADDED")

                              }, function myFialure(response)
                              {

                              })

                            }, function myError(response) {
                                
                            
                            
                            
                        });
                }
            });
        app.controller('registerCtrl', function($scope, $http) {
            $http({
                method : "GET",
                url : "http://localhost:3000/GetAllPOIs"
                }).then(function mySuccess(response) {
                    
                    var categories = document.getElementById("category_signup");
                    var set = new Set([]);
                    for(var i=0; i<response.data.length;i++)
                    {
                        set.add(response.data[i]["category"]);
                        
                    }
                    for (let item of set)
                    {
                        var option = document.createElement("option");
                        option.text = item;
                        categories.add(option);
                    }
                    
                    }, function myError(response) {
                        
                    
                    
                });
                
                $scope.submit = function()
                {
            
                 
                 
                      
                        var newUser = Submit();
                        $http({
                            method: "POST",
                            url: "http://localhost:3000/registerUser",
                            data: {username : newUser.username,
                                   password : newUser.password,
                                   firstName : newUser.firstName,
                                   lastName : newUser.lastName,
                                   city : newUser.city,
                                   country : newUser.country,
                                   email : newUser.email,
                                   category1 : newUser.categories[0],
                                   category2 : newUser.categories[1]
                                 }
                        }).then(function mySuccess(response) {
                    
                            //Worked
                            $http({
                            method: "POST",
                            url: "http://localhost:3000/insertQuestion",
                            data: {username : newUser.username,
                                   question : newUser.question,
                                   answer : newUser.answer
                                 }
                        }).then(function mySuccess(response) {
                    
                            //Worked
                            
                    }, function myError(response) {
                        
                    //error
                    
                     });
                            
                    }, function myError(response) {
                        
                    //error
                    
                     });

                    
                }
            });
        var src;
        var checkedSort = false;
        var checkedSort_personal = false;
        var isFiltered = false;
        var isFiltered_personal = false;
        var categorySelection = "";
        var modal;
        var span;
        var inTheMiddleOfSwitch = false;
        var sub1;
        var sub2;
        var prevSection;
        var section_containers = [];
        var countries = "<Countries>"+"<Country>"+"<ID>1</ID>"+"<Name>Australia</Name>"+"</Country>"+"<Country>"+
		"<ID>2</ID>"+"<Name>Bolivia</Name>"+ "</Country>"+ "<Country>"+"<ID>3</ID>"+"<Name>China</Name>"+
        "</Country>"+"<Country>"+ "<ID>4</ID>"+"<Name>Denemark</Name>"+"</Country>"+"<Country>"+ "<ID>5</ID>"+
        "<Name>Israel</Name>"+"</Country>"+"<Country>"+ "<ID>6</ID>"+"<Name>Latvia</Name>"+"</Country>"+"<Country>"+
        "<ID>7</ID>"+ "<Name>Monaco</Name>"+ "</Country>"+"<Country>"+"<ID>8</ID>"+"<Name>August</Name>"+"</Country>"+
        "<Country>"+"<ID>9</ID>"+"<Name>Norway</Name>"+"</Country>"+"<Country>"+"<ID>10</ID>"+"<Name>Panama</Name>"+
        "</Country>"+ "<Country>"+"<ID>11</ID>"+"<Name>Switzerland</Name>"+ "</Country>"+"<Country>"+"<ID>12</ID>"+
        "<Name>USA</Name>"+"</Country>"+"</Countries>";
        
        function sortAlone()
        {
            if(!isFiltered_personal&&!checkedSort_personal)
            {
                inTheMiddleOfSwitch = !inTheMiddleOfSwitch ;
                if(inTheMiddleOfSwitch) 
                {
                    document.getElementById("sort_by_yourself_btn_personal").style.backgroundColor = "#6495ED";
         
                    
                }
                else
                {
                    document.getElementById("sort_by_yourself_btn_personal").style.backgroundColor = "cadetblue" ;
                    var help;//equals to undefined
                    
                    if(typeof sub1 !='undefined')
                    {
                        sub1.style.borderStyle = "none"
                        sub1 = help;

                        
                    }
                    if(typeof sub2 !='undefined')
                    {
                        sub2.style.borderStyle = "none"
                        sub2 = help;
                        
                    }
                }
            }
        }
        function GoTo(section_name)
        {   
            var menu_extension = "_menu";
            var select_color = "#336b87";
            var regular_background_color = "#90afc5";
            
           
           // modal.style.display = "none";
            //var welcome = document.getElementById('welcome');
            //welcome.style.display = "none";
            //var welcome_menu = document.getElementById('welcome' +menu_extension);
            //welcome_menu.style.backgroundColor = regular_background_color;

            var signup = document.getElementById('signup');
            signup.style.display = "none";
            var signup_menu = document.getElementById('signup' +menu_extension);
            signup_menu.style.backgroundColor = regular_background_color;

            var login = document.getElementById('login');
            login.style.display = "none";
            var login_menu = document.getElementById('login' +menu_extension);
            login_menu.style.backgroundColor = regular_background_color;

            var about = document.getElementById('about');
            about.style.display = "none";
            var about_menu = document.getElementById('about' +menu_extension);
            about_menu.style.backgroundColor = regular_background_color;

            var about = document.getElementById('POI');
            about.style.display = "none";
            var about_menu = document.getElementById('POI' +menu_extension);
            about_menu.style.backgroundColor = regular_background_color;

            var about = document.getElementById('POI_user');
            about.style.display = "none";
            var about_menu = document.getElementById('POI_user' +menu_extension);
            about_menu.style.backgroundColor = regular_background_color;

            var restore = document.getElementById('restorePassword');
            restore.style.display = "none";

            var restore = document.getElementById('modalSection');
            restore.style.display = "none";

            var restore = document.getElementById('singlePhoto');
            restore.style.display = "none";

            var go_to = document.getElementById(section_name);
            go_to.style.display = "block";

            if(section_name != "restorePassword" && section_name!="singlePhoto" && section_name!="modalSection")
            {
                var menu_go_to = document.getElementById(section_name+menu_extension);
                menu_go_to.style.backgroundColor = select_color;
            }
            

            document.getElementById("sort_POI").hidden = true;
            document.getElementById("sort_POI_personal").hidden = true;
            document.body.style.backgroundImage = "url('source/background.jpeg')";

            leave();

             if(section_name === "signup")
                {
                    ResetSignUp();
                 
                }
                else
                {
                    if(section_name === "login")
                    {
                        if(!first)
                            ResetLogin();
                        else
                            first=false;
                 
                    }
                    else
                    {
                       
                            if(section_name === "about")
                            {
                                document.body.style.backgroundImage = "url('source/background_game.jpg')";
                               // addAboutPhotos();
                            }
                            else
                            {
                                if(section_name === "POI")
                                {
                                    document.getElementById("sort_POI").hidden = false;
                                    resetToolbar();
                                    photoDisplay("");

                                }
                                else
                                {
                                    if(section_name === "POI_user")
                                    {
                                        document.getElementById("sort_POI_personal").hidden = false;
                                        resetToolbarPersonal();
                                        displayPhotosPersonalByUsername(current.username);
                                    }
                                    else
                                    {
                                        if(section_name === "restorePassword")
                                        {
                                            resetRestore();
                                        }
                                        else
                                        {
                                            if(section_name === "modalSection")
                                            {
                                                resetModal();
                                            }
                                        }
                                    }   
                                }
                            }
                        
                    }
                }
            


        }
        function resetToolbar()
        {
         
            document.getElementById("select_category_filter").selectedIndex = 0;
            checkedSort = false;
            isFiltered = false;
            document.getElementById("sort_by_rank_btn").style.backgroundColor = "cadetblue";

            
        }
        function resetToolbarPersonal()
        {
         
            
            checkedSort_personal = false;
            isFiltered_personal = false;
            document.getElementById("upload_btn").value = "Upload 2 Server";
            document.getElementById("sort_by_rank_btn_personal").style.backgroundColor = "cadetblue";
            document.getElementById("filter_by_category_btn_personal").style.backgroundColor = "cadetblue";
            document.getElementById("sort_by_yourself_btn_personal").style.backgroundColor = "cadetblue";
            document.getElementById("sort_by_rank_btn_personal").disabled= false;
            document.getElementById("filter_by_category_btn_personal").disabled= false;
            document.getElementById("sort_by_yourself_btn_personal").disabled= false;
            var help;//equals to undefined
                if(typeof sub1 !='undefined')
                {
                    sub1.style.borderStyle = "none"
                    sub1 = help;
                }
                if(typeof sub2 !='undefined')
                {
                    sub2.style.borderStyle = "none"
                    sub2 = help;
                }
            inTheMiddleOfSwitch = false;
            
        }
        function updatingLocalPos(favorites,poiId)
        {
            var index = favorites.indexOf(poiId+"?");
            var temp = favorites.substring(index+poiId.length+1);
            var index2 = temp.indexOf(",");
            var position = temp;
            if(index2!=-1)
            {
                position = temp.substring(0,index2);
            }
            
            var positionNum = parseInt(position);
            var split = favorites.split(",");
            for(var i = positionNum+1;i<split.length;i++)
            {
                favorites = favorites.replace("?"+i,"?"+(i-1));
            }
            return favorites
        }
        function removeFromLocal(favorites,poiId)
        {
            favorites = updatingLocalPos(favorites,poiId)
            
            var index = favorites.indexOf(poiId+"?");
            
            if(index <=0)
            {
                var index2 = favorites.indexOf(",")
                if(index==-1)//only one
                {
            
                    favorites = "";
                }
                else
                {
            
                    favorites = favorites.substring(index2+1);
                }
            }
            else
            {
            

                var temp = favorites.substring(index);
                var index3 =temp.indexOf(",");
                if(index3!=-1)
                    favorites = favorites.substring(0,index-1)+ temp.substring(index3);
                else
                    favorites = favorites.substring(0,index-1)
            }
         
            
            numberOfFavorites--;
            window.sessionStorage.setItem("favorite",favorites);
        }
        function getLocalFavorites()
        {
            var favorites = window.sessionStorage.getItem("favorite");
            if(favorites === null)
                return [];
                
            var split = favorites.split(",");
            
            var favoriteName = [];
            for(var i =0; i<split.length;i++)
            {
                var index = split[i].indexOf("?");
                favoriteName.push(split[i].substring(0,index));
            }
            return favoriteName;
        }
        function getIdByPositionLocal(pos)
        {
            var favorites = window.sessionStorage.getItem("favorite");
            if(favorites === null)
                return [];
                
            var split = favorites.split(",");
            
            var favoriteName = [];
            for(var i =0; i<split.length;i++)
            {
                var index = split[i].indexOf("?");
                if(parseInt(split[i].substring(index+1)) == pos)
                    return split[i].substring(0,index);
            }
            return "";
        }
        function getPositionByIdLocal(id)
        {
            var favorites = window.sessionStorage.getItem("favorite");
            if(favorites === null)
                return [];
                
            var split = favorites.split(",");
            
            var favoriteName = [];
            for(var i =0; i<split.length;i++)
            {
                var index = split[i].indexOf("?");
                if(split[i].substring(0,index) === id)
                    return parseInt(split[i].substring(index+1));
            }
            return -1;
        }
        function switchPlaces(array,category,index1,index2)
        {
            var temp = array[category][index1];
            array[category][index1] = array[category][index2];
            array[category][index2] = temp;
        }
        function makeValid()
        {
            
            angular.element(document.getElementById('signup')).scope().submit();
            
            
            
        }
        function getCurrentSection(element)
        {
            while(element.nodeName.toLowerCase() != "section")
            {
                element = element.parentNode;
            }
            return element.id;
        }
        function tryLogin()
        {
            var token = window.sessionStorage.getItem("token")
            if(token!=null)
            {
                angular.element(document.getElementById("login")).scope().autoLogin(token);
            }
        }
        function Initialize()
        {
           // window.sessionStorage.removeItem("favorite")
           //window.sessionStorage.removeItem("token")
            

            
            modal = document.getElementById('myModal');
            modal.hidden = true;
            span  = document.getElementsByClassName("close")[0];
            span.onclick = function() {
                    modal.style.display = "none";
                    GoTo(prevSection);
                }
         
           

            src = {};
            photoDisplay("");
            document.getElementById("select_category_filter").onchange = function()
            {

                var select = document.getElementById("select_category_filter").value;
                if(select === "No Filter")
                {
                    isFiltered = false;
                     //Change to server output
                     photoDisplay("");
                }
                else
                {
                    isFiltered = true;
                    photoDisplay(select);
                }
                
            };
            
            document.getElementById("sort_by_rank_btn").onclick = function()
            {
                checkedSort = !checkedSort;
                if(!checkedSort)
                {
                    document.getElementById("sort_by_rank_btn").style.backgroundColor = "cadetblue" ;
                    
                }
                else
                {
                    document.getElementById("sort_by_rank_btn").style.backgroundColor = "#6495ED";
                }

                
                var select = document.getElementById("select_category_filter").value;
                if(select === "No Filter")
                {
                
                     isFiltered = false;
                     //Change to server output
                     photoDisplay("");
                }
                else
                {
                    isFiltered = true;
                    photoDisplay(select);
                }
                
            };
            document.getElementById("sort_by_rank_btn_personal").onclick = function()
            {
                if(!inTheMiddleOfSwitch)
                {
                    checkedSort_personal = !checkedSort_personal;
                    if(!checkedSort_personal)
                    {
                        document.getElementById("sort_by_rank_btn_personal").style.backgroundColor = "cadetblue" ;
                        
                    
                    }
                    else
                    {
                        document.getElementById("sort_by_rank_btn_personal").style.backgroundColor = "#6495ED";
                        document.getElementById("filter_by_category_btn_personal").style.backgroundColor = "cadetblue" ;
                        
                    
                        isFiltered_personal = false;

                    }
                    displayPhotosPersonalByUsername (current.username);
                }
                
            };
            document.getElementById("filter_by_category_btn_personal").onclick = function()
            {
                if(!inTheMiddleOfSwitch)
                {
                    isFiltered_personal = !isFiltered_personal;
                    if(!isFiltered_personal)
                    {
                        document.getElementById("filter_by_category_btn_personal").style.backgroundColor = "cadetblue" ;
                        document.getElementById("sort_by_rank_btn_personal").disabled= false;
                        document.getElementById("sort_by_yourself_btn_personal").disabled= false;

                    }
                    else
                    {
                        document.getElementById("sort_by_rank_btn_personal").disabled= true;
                        document.getElementById("sort_by_yourself_btn_personal").disabled= true;
                        checkedSort_personal = false;
                        document.getElementById("sort_by_rank_btn_personal").style.backgroundColor = "cadetblue" ;
                        document.getElementById("filter_by_category_btn_personal").style.backgroundColor = "#6495ED";
                    }
                    displayPhotosPersonalByUsername (current.username);
                }    
                
            };
           
            resetCountries();

           
            tryLogin();
            document.getElementById('POI_user_menu').hidden = true;
            document.getElementById('sort_POI').hidden = true;
            setImagesOnClick();
            changeHello();
            
            var starting_page = 'login';
            GoTo(starting_page);

        }
        function setImagesOnClick()
        {
            let images = document.getElementsByTagName("img");
            
            for(var i=0;i<images.length;i++)
            {
                
                let id = images[i].id
                let givenid = id;
                if(id.substring(id.length-3) === "poi")
                {
                    id = id.substring(0,id.length-3)
                }
                else
                {
                    if(id.substring(id.length-4) === "pois" || id.substring(id.length-4) === "poir")
                    {
                        id = id.substring(0,id.length-4)
                    }   
                }
                if(id != "singlePhotoImage" && id.substring(0,5)!="small" && id!="logo" && id.substring(0,6)!="2small" && id.substring(0,9)!="about_img")
                {
                    //src[images[i].id] =images[i].src;
                    images[i].onclick = function ()
                    {
                        if(!inTheMiddleOfSwitch)
                            displaySinglePhoto(id);
                        else
                        {
                            console.log("summon1")
                            addSub(givenid);
                        }
                    };
                }
                
                
                
            }
          
            
            
        }
        function whenLoggin()
        {
            document.getElementById("signup_menu").hidden = true;
            document.getElementById("POI_user_menu").hidden = false;
            numberOfFavorites = angular.element(document.getElementById('POI_user')).scope().getNumberOfFavorites(current.username)
            changeHello();
            GoTo('POI_user');
        }
        function IsLogged()
        {
            return !(typeof current === "undefined");
        }
        function changeHello()
        {
            var hello = document.getElementById("hello");
            var helloString = "hello ";
            var isloogged = IsLogged();
            if (!isloogged) 
            { 
                    hello.innerHTML = helloString+ "guest";
            }
            else
            {
                hello.innerHTML = helloString + current.username;
            }
        }
        
        function displaySinglePhoto (id)
        {
            
            var sectionId = "singlePhoto";
            
            //here add control to section
            var src = angular.element(document.getElementById(sectionId)).scope().getDetailed(id.substring(3));
            

            
        }
    </script>

</head>

<body id="body" >
    <style>
        .modal {
                display: none;
                height: 200px;
                width: 200px;
                padding-top: 100px;
                position: absolute;
                left:0;
                top: 0;
            }
            #text
            {
                width:100%;
            }
            #commit_btn2{
                width: 50%;
                display: inline-block;
                margin-bottom: 1%;
                padding: 20px 0px;
                text-align: center;
                color: white;
                font-family: "Comic Sans MS", "Comic Sans", cursive;
                position: relative;
                background: linear-gradient(-45deg,#336b87,#90afc5);
            }
    
            .modal-content {
                background-color: #fefefe;
                margin: auto;
                padding: 20px;
                border: 1px solid #888;
                width: fit-content;
                height: fit-content;
            }
    
            .close {
                color: #aaaaaa;
                float: right;
                font-size: 28px;
            }
        </style>
      
      
        
                
            <script>
                function switchPlacesPersonal(pointOfInterestArray, i, startIndex, index)
                {
                    var temp = pointOfInterestArray[i][startIndex];
                    pointOfInterestArray[i][startIndex] = pointOfInterestArray[i][index];
                    pointOfInterestArray[i][index] = temp;
                }
                function extractData(){
                    var x = document.getElementById("text").value;
                    var e = document.getElementById("numbers");
                    var strUser = e.options[e.selectedIndex].text; 
                    
                    var poiName = modalPoi;
              
                    angular.element(document.getElementById('myModal')).scope().saveReview(x,strUser,poiName,current.username);
                }
        
                
        
                
        
                function showAbout(element) {
                    
                    modal.style.display = "block";
                    
                    if(element.poi.substring(element.poi.length -3)==="poi")
                    {
                        element.poi = element.poi.substring(0,element.poi.length-3);
                    }
                    else
                    {
                        if(element.poi.substring(element.poi.length -4)==="pois" || element.poi.substring(element.poi.length -4)==="poir")
                                element.poi = element.poi.substring(0,element.poi.length-4);
                    }
                    document.getElementById("modalComment").innerHTML = "Comment on "+element.poi;
                    modalPoi = element.poi;
                    prevSection = getCurrentSection(element);
                }
        
           
        
               
        
                addEventListener("keydown", function (e) {
                    if(event.keyCode==27 && modal.style.display == "block"){
                        modal.style.display = "none";
                        GoTo(prevSection);
                    }
                }, false);
            </script>
    
    
<style>
    #body {
        background: url('source/background.jpeg') no-repeat center center fixed;
        -webkit-background-size: cover;
        -moz-background-size: cover;
        -o-background-size: cover;
        background-size: cover;
        image-rendering: optimizeQuality;
    }
    ul {
        list-style-type: none; /*Get the dots off*/
        margin: 0;
        padding: 0;
        overflow: hidden;
        position: -webkit-sticky; /* Safari */
        position: sticky;
        top: 0;
        background-color: #90afc5;
    }

    li {
        float: left;
    }

    li a {
        display: block;
        color: white;
        text-align: center;
        padding: 14px 16px;
        font-family: "Comic Sans MS", "Comic Sans", cursive;
    }

        .btn
        {
            width: 100%;
            display: inline-block;
            margin-bottom: 1%;
            padding: 20px 0px;
            text-align: center;
            color: white;
            font-family: "Comic Sans MS", "Comic Sans", cursive;
            position: relative;
            background: linear-gradient(-45deg,#336b87,#90afc5);


        }

        #welcome_div
        {
            position: fixed;
            top:75%;
            width: 100%;

        }
        
        #search_menu_txt
        {
            margin-top: 8%;
            width: 60 px;
            height: 4%;
            


            
        }

        #search_btn{
            margin-left: 30%;
            width:60px;
            height: 10px;
            padding-top: 20%;
            text-align: center;
            
        }
  
        #commit_btn
        {
            
            margin-top:12px;
        }
        #search_menu
        {
            margin-left: 53%;
        }
        #select_category_filter
        {
            margin-top: 17px;
        }
        #sort_POI
        {
            padding-left: 40%;
            background-color:cadetblue;
        }
      
        #sort_POI_personal
        {
            padding-left: 35%;
            background-color:cadetblue;
        }
        #upload_btn
        {
            height: fit-content;
        }
       
</style>

<ul>
    <li id="login_menu" onclick="GoTo('login')"><a>Welcome</a></li>
    <li id="signup_menu" onclick="GoTo('signup')"><a>Sign Up</a></li>
    <li id="about_menu" onclick="GoTo('about')"><a>About</a></li>
    <li id="POI_menu" onclick="GoTo('POI')"><a>POI's</a></li>
    <li id="POI_user_menu" onclick="GoTo('POI_user')"><a id="favoriteCountDisplayer">Personal Area</a></li>
    <li id="search_menu"><a>search:</a></li>
    <li id="search_menu_right"><input type="text" id="search_menu_txt" text-align ="center"> </li>
    <li id="commit_btn"> <input class="btn" type="button" id="search_btn" value="search" onclick="search()"></li>
</ul>
<ul id="sort_POI">
    <li id="filter_by_category_btn"><a>filter by category</a></li>
    <li><select id="select_category_filter">
        <option>No Filter</option>
      
    </select></li>
    <li id="sort_by_rank_btn"><a>Sort by rank</a></li>  
</ul>

<ul id="sort_POI_personal">
    <li id="filter_by_category_btn_personal"><a>Sort by category</a></li>
    <li id="sort_by_rank_btn_personal"><a>Sort by rank</a></li>  
    <li id="sort_by_yourself_btn_personal" onclick="sortAlone()"><a>Sort by Yourself</a></li>  
    <li id="upload_personal"><input class="btn" type="button" id="upload_btn" value="Upload 2 Server"  onclick = "uploadToServer()"></li>  
</ul>
<script type="text/javascript">

var numberOfFavorites = -1;
function uploadToServer()
{
    
    var favorites = window.sessionStorage.getItem("favorite");
    var split = favorites.split(",");
    for(var i=0; i<split.length;i++)
    {
        var index = split[i].indexOf("?");
        angular.element(document.getElementById('POI_user')).scope().uploadFavorite(current.username,split[i].substring(0,index),split[i].substring(index+1));
    }

    

    

}
function displayNumberOfFavorites()
{
    var id="favoriteCountDisplayer";
  
    var displayer = document.getElementById(id);
    displayer.innerHTML="Personal Area("+numberOfFavorites+")";
    var timeInseconds =3;
    setTimeout(() => {
  displayer.innerHTML="Personal Area"
    , 1000*timeInseconds});
    
}
function checkIfFavoriteLocal(id)
{
    var favorites = window.sessionStorage.getItem("favorite");
    return (favorites.indexOf(id+"?"))!= -1;
}
function uploadLocal(id)
{
    //update number of favorites if -1
    var position = numberOfFavorites;
    numberOfFavorites++;
    var favorites = window.sessionStorage.getItem("favorite")
    
    var idNew = id;
        if(id.substring(id.length-3) === "poi")
        {
            idNew = id.substring(0,id.length-3)
        }
        else
        {
        if(id.substring(id.length-4) === "pois" || id.substring(id.length-4) === "poir")
            {
                idNew = id.substring(0,id.length-4)
            }   
        }
        if(favorites.indexOf(idNew+"?")==-1)
            favorites = favorites+","+idNew+"?"+position;
  
    
    window.sessionStorage.setItem("favorite",favorites)
    
}
function switchValues(id1,position1,id2,position2)
{
    var favorites = window.sessionStorage.getItem("favorite")
  
    console.log("Switching between "+id1+" to "+ id2 );
    console.log("before switch")
    console.log(favorites);
    console.log("look for1 "+id1+"?"+position1)
    console.log("look for2 "+id2+"?"+position2)
    var index1 = favorites.indexOf(id1+"?"+position1)
    var index2 = favorites.indexOf(id2+"?"+position2)
    var minId = '';
    var minPosition = -1;
    var minIndex = -1;
    var maxId = '';
    var maxPosition = -1;
    var maxIndex = -1;
    if(index1>index2)
    {
            minId=id2;
            minPosition = position2;
            minIndex = index2;
            maxId=id1;
            maxPosition = position1;
            maxIndex = index1;
    }
    else
    {
            minId=id1;
            minPosition = position1;
            minIndex = index1;
            maxId=id2;
            maxPosition = position2;
            maxIndex = index2;
    }
    var expMax = maxId;
    var expMin = minId;
    console.log("minIndex " +minIndex)
    console.log("maxIndex " +maxIndex)
    console.log("1 "+favorites.substring(0,minIndex))//until the min
    console.log("2 "+expMax)//insteadof the min
    console.log("3 "+favorites.substring(minIndex+expMin.length,maxIndex))
    console.log("4 "+expMin)
    console.log("5 "+ favorites.substring(maxIndex+expMax.length))
    favorites = favorites.substring(0,minIndex)+expMax+favorites.substring(minIndex+expMin.length,maxIndex)+expMin+favorites.substring(maxIndex+expMax.length)
    console.log("after switch")
    console.log(favorites);
    window.sessionStorage.setItem("favorite",favorites)
}
</script>
<section id="singlePhoto" ng-controller = "singleCtrl">
    <style>
        #singlePhoto
        {
            text-align: center;
        }

        #singlePhotoDiv
        {
            position: relative;
            width: fit-content;
            height: fit-content;
            left: 15%;
        }
        #list_statistics
        {
            text-align: left;
            position: relative;
            float: right;
            margin-left: 20px;
            color: black;
            background: #cee9ea;
            margin-top: 1%;
            display: block;
            
            
        }
        .li_statistics{
            display: block;
            width:100px;
        }
    </style>
    <div id="singlePhotoDiv" class="userdiv">
            <img height="600" width= "600" id="singlePhotoImage">
        <div id="list_statistics" display ="block">
            <p class="li_statistics"><h1 id="name_poi_des">{{Name}}</h1></p>
            <p class="li_statistics"><h1>{{Viewrs}}</h1></p>
            <p class="li_statistics"><h4 id="descriptionH4"> </h4></p>
            <p class="li_statistics"><h1>{{Rank}}</h1></p>
            <p class="li_statistics"><h4>{{Review1}} </h4></p>
            <p class="li_statistics"><h4>{{Review2}} </h4></p>
        </div>
    </div>
    

</section>
<section id="signup" display="none" ng-controller = "registerCtrl">
    <style>
        .userdiv{

            background: #cee9ea;
            padding: 10px;
            width: 40%;
            color: red;


        }
        .sign_up_labels
        {
            color: black;
        }
        .inptUser
        {
            position: relative;
            margin-top: 15px;
            margin-bottom: 15px;
            margin-right: 15px;
            width: 100%;
        }
        .inptUser_signup
        {
            position: relative;
            margin-top: 15px;
            margin-bottom: 15px;
            margin-right: 15px;
            width: 12%;
        }
        #div_signup
        {
            position:fixed;
            height: fit-content;
            
            top: 25%;
            left: 30%;
            
        }
        .errorMessages
        {
            color: red;
        }
      
        .sign_up_labels_signup
        {
            color: black;
            text-align: center;
            font-weight: bold;
            
        }
        #sign_up_headline
        {
            color:black;
        }
        #sign_up_div
        {
            width:100%;
            text-align: center
        }
        #username_signup
        {
            margin-left:6.5px ;
        }
        #email_signup
        {
            margin-left:33px ;
        }
        #country_signup
        {
            margin-left:19px ;
            width: 10%; 
        }
        
        #city_lbl
        {
            margin-left: 84px;
        }
        #city_signup
        {
            margin-left:44px;
        }
        #password_lbl
        {
            margin-left: 42px;
        }
        #password_signup
        {
            margin-left:9px;
        }
        #submit_btn
        {
            
            width:42%;
        }
        #answer_lbl
        {
            margin-left: 42px;
            
        }
        
        #lastName_lbl
        {
            margin-left: 42px;
        }
       #category_signup
       {
            margin-left: 20px;
            position: relative;
            
       }
      
    </style>
    
         
    <div  id="sign_up_div"> 
        <h1 id = "sign_up_headline">Sign Up</h1>
        <form id="sign_up_form">
            
            <!--Username-->
            <label id="username_lbl" for="username_signup" class="sign_up_labels_signup" >Username</label>
            <input class="inptUser_signup" type="text" id="username_signup" placeholder="Username" name="username">
            <!--Password-->
            <label for="password_signup" class="sign_up_labels_signup" id="password_lbl">Password</label>
            <input class="inptUser_signup" type="password" id="password_signup" placeholder="Password" name="password">
            <br/>
            <!--First name-->
            <label for="firstName_signup" class="sign_up_labels_signup">First Name</label>
            <input class="inptUser_signup" type="text" id="firstName_signup" placeholder="First Name" name="fName">
            <!--Last name-->
            <label for="lastName_signup"  id="lastName_lbl" class="sign_up_labels_signup">Last Name</label>
            <input class="inptUser_signup" type="text" id="lastName_signup" placeholder="Last Name" name="lName">
            <br/>
            <!--Country-->
            <label for="country_signup" class="sign_up_labels_signup" id="country_lbl">Country</label>
            <select name="country" id="country_signup" class="inptUser_signup" >
               <option>Select Country</option>
            </select>
            <!--City-->
            <label for="city_signup" class="sign_up_labels_signup" id="city_lbl">City</label>
            <input class="inptUser_signup" type="text" id="city_signup" text-align ="center" name="city" placeholder="city">
            <br/>
            <!--Question-->
            <label for="question" class="sign_up_labels_signup" id="question_lbl">Question</label>
            <input class="inptUser_signup" type="text" id="question_signup" text-align ="center" name="question" placeholder="Question">
            <!--Answer-->
            <label for="answer" class="sign_up_labels_signup" id="answer_lbl">Answer</label>
            <input class="inptUser_signup" type="text" id="answer_signup" text-align ="center" name="answer" placeholder="Answer">
            <br/>
            <!--Username-->
            <label for="email_signup" class="sign_up_labels_signup">Email</label>
            <input class="inptUser_signup" type="text" id="email_signup" placeholder="Email Address" name="email">
            <!--Categories-->
            <br/>
            <label for="category_signup" class="sign_up_labels_signup" id="category_lbl">Categories</label>
            <br/>
            <select multiple name="Categories" id="category_signup" class="inptUser_signup">
               
             </select>
            <br/>
            <label id = "errors_signup" class="errorMessages"></label>
            <br/>
            <input class="btn" type="submit" id="submit_btn" value="Submit">
        </form>
        
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
        <br/>
    </div>
    <script type="text/javascript">
        function search()
        {
            var id = document.getElementById("search_menu_txt").value;
            
            
            angular.element(document.getElementById("singlePhoto")).scope().getDetailed(id);

        }
        function addCustomImage(srcBig,width,height,element,id)
        {
        
            //The big img
            const bigImage = document.createElement('img');
            bigImage.src = srcBig;
            bigImage.width = width;
            bigImage.height = height;
            bigImage.id = "big"+id;
            
            //The container
            const container = document.createElement('div');
            container.id = "container"+id;
            container.style.position = "relative";
            container.width = width;
            container.height = height;
            
            
            //The small img
            //Add the small img only of logged..
            const smallImage = document.createElement('img');
            smallImage.id = "small"+id;
            smallImage.src = "source/unchecked.png";
            if(IsLogged())
                angular.element(document.getElementById('about')).scope().checkIfFavorite(current.username,id,smallImage);
            const smallWidth = width/9;
            const smallHeight = height/9;
            smallImage.width = smallWidth;
            smallImage.height = smallHeight;
            
            smallImage.style.marginBottom= (height - smallHeight)+ "px";
            smallImage.style.left = width+"px";
            smallImage.style.position = "relative";
            smallImage.onclick = function()
            {
                if(!inTheMiddleOfSwitch)
                {
                    var small =  document.getElementById("small"+id);
                    if(small.src.includes( "source/unchecked.png"))
                    {
                        //add
                        uploadLocal(id);
                        displayNumberOfFavorites();
                        smallImage.src = "source/checked.png";
                     
                    }
                    else
                    {
                        //remove
                        smallImage.src = "source/unchecked.png";
                        angular.element(document.getElementById('POI_user')).scope().removeFavorite(current.username,id)
                    }
                    
                }
                else
                {
                    console.log("summon2")
                    addSub(bigImage.id);
                }
            }

            


            

            container.appendChild(smallImage);
         
            
        
        container.appendChild(bigImage);
            element.appendChild(container);

            container.poi = id;
            
                const smallImage2 = document.createElement('img');
            smallImage2.src = "source/message.png";
            const smallWidth2 = width/9;
            const smallHeight2 = height/9;
            smallImage2.width = smallWidth2;
            smallImage2.height = smallHeight2;
            smallImage2.id = "2small"+id;
            //smallImage2.style.marginBottom= (height - smallHeight2)+ "px";
            smallImage2.style.right = smallWidth2+"px";
            smallImage2.style.position = "relative";
            container.appendChild(smallImage2);
                smallImage2.onclick = function()
                {
                    if(!inTheMiddleOfSwitch)
                    {
                        modal.style.display = "none";
                        var small =  document.getElementById("container"+id);
                        showAbout(small);
                        GoTo("modalSection");
                    }
                    else
                    {
                        console.log("summon3")
                        addSub(bigImage.id);
                    }
                        
                    
                }
                var isLogged = IsLogged();
            if(!isLogged)
            {
                smallImage.hidden = true;
                smallImage2.hidden = true;
            }
            return container;
            
        } 
        function addSub(id)
        { 
            if(id.substring(id.length-4) != "pois")
                return
            if(typeof sub1 === 'undefined')
            {
                sub1 = document.getElementById(id);
                sub1.style.borderStyle = "solid"
                sub1.style.borderWidth = "15px";
                sub1.style.borderColor = "Green";
            }
            else
            {
                sub1.style.borderStyle = "none"
                if(sub1.id != id)
                {
                    sub2 = document.getElementById(id);
                    
                    var id1 = sub1.id.substring(3,sub1.id.length-4);
                    var id2 = sub2.id.substring(3,sub2.id.length-4);
                    
                    var pos1 = getPositionByIdLocal(id1);
                    var pos2 = getPositionByIdLocal(id2);
                    switchValues(id1,pos1,id2,pos2);
                    inTheMiddleOfSwitch = false;
                    GoTo('POI_user');
                }
                else
                {
                    resetToolbarPersonal()
                }
            }
        }
        function getSelectValues(select) {
            var result = [];
            var options = select && select.options;
            var opt;

            for (var i=0, iLen=options.length; i<iLen; i++) {
                opt = options[i];

                if (opt.selected) {
                result.push(opt.value || opt.text);
                }
            }
            return result;
        }
        function resetCountries()
        {
            var parser = new DOMParser();
            var xmlDoc = parser.parseFromString(countries,"text/xml");
            var countries2 =xmlDoc.getElementsByTagName('Name');
            var country_select = document.getElementById('country_signup');
            country_select.remove(0);

            for(var i=0; i<countries2.length;i++)
            {
                var option = document.createElement("option");
                option.text = countries2[i].childNodes[0].nodeValue;
                country_select.add(option);
            }


        }
        function Submit() {
            
            var username = document.getElementById('username_signup').value;
            var password = document.getElementById('password_signup').value;
            var firstName = document.getElementById('firstName_signup').value;
            var lastName = document.getElementById('lastName_signup').value;
            var email = document.getElementById('email_signup').value;
            var country_select = document.getElementById('country_signup');
            var city = document.getElementById('city_signup').value;
            var question = document.getElementById('question_signup').value;
            var answer = document.getElementById('answer_signup').value;
            var category_select = document.getElementById('category_signup');
            //var strUser = e.options[e.selectedIndex].text;
            var country = country_select.options[country_select.selectedIndex].text;
            
            //if it's ok then:
            var newUser = new Object();
            newUser.username = username;
            newUser.password = password;
            newUser.firstName = firstName;
            newUser.lastName = lastName;
            newUser.email = email;
            newUser.country = country;
            newUser.city = city;
            newUser.question = question;
            newUser.answer = answer;
            newUser.categories = getSelectValues(category_select);
            //newUser.birthdate = birthDate;
            
            GoTo('login');
            return newUser;
            

        }
        function ResetSignUp()
        {
            document.getElementById('username_signup').value="";
            document.getElementById('password_signup').value="";
            document.getElementById('firstName_signup').value="";
            document.getElementById('lastName_signup').value="";
            document.getElementById('email_signup').value="";
            document.getElementById('country_signup').selectedIndex=0;
            document.getElementById('question_signup').value="";
            document.getElementById('answer_signup').value="";
            document.getElementById('city_signup').value="";
           // document.getElementById('birthDate_signup').value=today;
        }
    </script>
</section>
<section id="login" display="none"    ng-controller="loginCtrl" >
        <style>
    
        
            #div_login
            {
                position:relative;
                left: 30%;
            }
            #li_restore_btn
            {
               
                width:100%;
            }
            #li_new_user_btn
            {
               
                width:100%;
            }
            #btn_list_login
            {
                display: inline-flex;
                width: 100%;
            
            }
            #explore_div
            {
                text-align: center;   
                position:relative;
                right:0%;
                bottom: 20%;
            
            }
        </style>
        <div class="userdiv" id="div_login">
            <h1 class="sign_up_labels">Login:</h1>
            <label class="sign_up_labels">Username</label>
            <br/>
            <input class="inptUser" type="text" id="username_login" placeholder="Username">
            <br/>
            <label for="password_signup" class="sign_up_labels">Password</label>
            <br/>
            <input class="inptUser" type="password" id="password_login" placeholder="Password" class="sign_up_labels">
            <br/>   
            <label id = "errors_login" class="errorMessages"></label>
            <br/>
            <br/>
            <br/>
    
            <input class="btn" type="button" id="login_btn" value="Log In" onclick="loginPressed()">
            <br/>
            <ul id="btn_list_login">
                <li id="li_restore_btn"><input class="btn" type="button" id="restore_btn" value="restore" onclick="GoTo('restorePassword')"></li>
                <li id="li_new_user_btn"><input class="btn" type="button" id="new_user" value="register" onclick="GoTo('signup')"></li>
            </ul>
        </div>
        <div id="explore_div">
            <p><h1 id="exploreh1">{{Explore}}</h1></p>
            <div id="div_explore">
                
            </div>
        </div>
        <script type="text/javascript">
        
               function ResetLogin()
            {
                var username = document.getElementById('username_login');
                var password = document.getElementById('password_login');
                username.value = "";
                password.value ="";
                addLoginPhotosNoParams();
            }
            function addLoginPhotosNoParams()
            {
              
                    var arr = []; 
                    for(key in loginPhotos)
                    {
                        arr.push(key);
                    }
                    addLoginPhotos(loginPhotos[arr[0]],loginPhotos[arr[1]],loginPhotos[arr[2]],arr[0],arr[1],arr[2]);
                
            }
            function addLoginPhotos(src1,src2,src3,id1,id2,id3)
            {

                
                var selection = document.getElementById("div_explore");
                var login_containers = [];
                var container1 = addCustomImage(src1,200,200,selection,id1);
                var container2 = addCustomImage(src2,200,200,selection,id2);
                var container3 = addCustomImage(src3,200,200,selection,id3);
                login_containers.push(container1);
                login_containers.push(container2);
                login_containers.push(container3);
                container1.style.cssFloat = "left";
                container1.style.marginLeft = "32.75%";
                container2.style.cssFloat = "left";
                container3.style.cssFloat = "left";

                section_containers.push(login_containers);
                setImagesOnClick();
            }
            function leave()
            {
                for(var i=0;i<section_containers.length;i++)
                {
                    for(var j=0;j<section_containers[i].length;j++)
                    {
                        section_containers[i][j].parentNode.removeChild(section_containers[i][j]);
                    }
                    
                }
                section_containers = [];
                
            }
            function loginPressed()
            {
                var username = document.getElementById('username_login').value;
                var password = document.getElementById('password_login').value;
                
                angular.element(document.getElementById("login")).scope().login(username,password);
                
            }
        
         
        </script>
    </section>
<section id="POI" display ="none" ng-controller = "getPOI">

    <style>
        .demo{
            text-align: center;
            
        }
        .POI_Images
        {
            margin-left: 12px;
            margin-bottom: 12px;
        }
        .div_poi_general
        {
            margin-bottom: 18%;
            align-content: center;
          
            
        }
    
    </style>
    <p class="demo" id="demo"></p>
    <script type="text/javascript">

        function photoDisplay(category)
        {
            angular.element(document.getElementById("POI")).scope().getCategories(category);
        }
        function noFilter(pointOfInterestArray)
        {
          
            if(!checkedSort)
            {
                for(key in pointOfInterestArray)
                {
                    var images = [];
                    for(var i=0;i<pointOfInterestArray[key].length;i++)
                    {
                        images.push({"src" : pointOfInterestArray[key][i]["pictureName"], "id" : pointOfInterestArray[key][i]["poiName"]})
                    }
                    pointOfInterestArray[key] = images;
                }
                displayPhotos(pointOfInterestArray)
            }
            else
                orderByRank(pointOfInterestArray)
        }//how to display
        
        function orderByRank(pointOfInterestArray)
        {
            
            var sectionId = "getPOI";
            angular.element(document.getElementById("POI")).scope().getRanks(true, pointOfInterestArray);
        }
        function filterByCategory(pointOfInterestArray,category)
        {
           
            
            for(key in pointOfInterestArray)
            {
                if(key!=category)
                {
                    delete pointOfInterestArray[key];
                }
            }
            
            if(!checkedSort)
            {
                for(key in pointOfInterestArray)
                {
                    var images = [];
                    for(var i=0;i<pointOfInterestArray[key].length;i++)
                    {
                        images.push({"src" : pointOfInterestArray[key][i]["pictureName"], "id" : pointOfInterestArray[key][i]["poiName"]})
                    }
                    pointOfInterestArray[key] = images;
                }
                displayPhotos(pointOfInterestArray)
            }
            else
                orderByRank(pointOfInterestArray)
        }
        function displayPhotos (pointOfInterestArray)
        {
            
            
            var x="";
            var i=0;
            for (var key in pointOfInterestArray) {
                
                

                x = x +"<div id=\"div_img"+i+"\" class=\"div_poi_general\">";
                x= x + "<h2>"+key+"</h2>";
                x= x + "<br/>"
                x = x+"</div>";
                
                i = i+1;
                    
            }

            document.getElementById("demo").innerHTML = x;

            i=0;
            var containers = [];
            for (var key in pointOfInterestArray) {
                
                var value = pointOfInterestArray[key];
                var selection = document.getElementById("div_img"+i);
                for(var j=0; j<value.length;j++)
                    {
                    
                        var container = addCustomImage(value[j]["src"],200,200,selection,value[j]["id"]+"poi");
                        container.classList.add("POI_Images");
                        container.style.cssFloat = "left";
                        containers.push(container);
                    }
                    if(value.length>0)
                    {
                        
                        document.getElementById("container"+value[0]["id"]+"poi").style.marginLeft = "20%";
                          
                    }
                selection.style.textAlign = "center";
                    i = i+1;
            }
            document.getElementById("demo").style.alignContent = "center";
            section_containers.push(containers);
            setImagesOnClick();
        }
    </script>

</section>
<section id="POI_user" display ="none" ng-controller = "personalCtrl">

        <style>
            #demo{
                text-align: center;
                
            }
            .personal_image
            {
                margin-left: 15px;
            }
            .div_poi_general2
            {
                margin-bottom: 18%;
                align-content: center;
            }
            #less_then
            {
                color: red;
            }
        </style>
        <p class="demo" id="demo_user"></p>
        <script type="text/javascript">

            function displayPhotosPersonalByUsername (username)
            {
                angular.element(document.getElementById('POI_user')).scope().displayPersonalImage(username);
                
                
            }
            function displayPhotosPersonal (pointOfInterestArray)
            {
                 //{id,src}
           
            var x="";
            x = x +"<div id=\"div_imgp"+0+"\" class=\"div_poi_general2\">";// class=\"div_poi_general\">";
            x = x+ "<h1>Saved point of interest </h1>"
            if(pointOfInterestArray[0].length<2)
            {
                x= x+"<h1 id=\"less_then\">There are less than <b>two</b> saved pictures</h1>";
            }    
            x= x + "<br/>"
            x = x+"</div>";
            x = x +"<div id=\"div_imgp"+1+"\" class=\"div_poi_general2\">";
            x = x+ "<h1>Recommended point of interest </h1>";
         
            x= x + "<br/>"
            x = x+"</div>";
            document.getElementById("demo_user").innerHTML = x;
            var containers = [];
            var selection = document.getElementById("div_imgp0");
            
            if(pointOfInterestArray[0].length>=2)
            {

                const  size = 960;
                var width = (size-pointOfInterestArray[0].length*15)/pointOfInterestArray[0].length;
                if(width>=300)
                {
                    width = 300;
                }
                var height = width;
                
                for(var j=0; j<pointOfInterestArray[0].length;j++)
                {
                 
                    var container = addCustomImage(pointOfInterestArray[0][j]["src"],width,height,selection,pointOfInterestArray[0][j]["id"]+"pois");
                    container.classList.add("personal_image");
                    container.style.cssFloat = "left";
                    containers.push(container);
                }
                document.getElementById("container"+pointOfInterestArray[0][0]["id"]+"pois").style.marginLeft = "20%";
            }
                
                selection = document.getElementById("div_imgp1");
                
                
                    for(var j=0; j<pointOfInterestArray[1].length;j++)
                    {
                        var container = addCustomImage(pointOfInterestArray[1][j]["src"],250,250,selection,pointOfInterestArray[1][j]["id"]+"poir");
                        container.classList.add("personal_image");
                        container.style.cssFloat = "left";
                        containers.push(container);
                    }
                    
                    if(pointOfInterestArray[1].length>0)
                {
                    document.getElementById("container"+pointOfInterestArray[1][0]["id"]+"poir").style.marginLeft = "20%";
                }
             
               section_containers.push(containers);
                setImagesOnClick();
            }
        </script>
    
    </section>
<section id="about" display="none" ng-controller = "customCtrl">
    <style>
        #about_img1
        {
            margin-left: 17%;
            
        }
        #about_img2
        {
            margin-left: 5%;
            
        }
        #about_img3
        {
            margin-left: 17%;
            margin-top: 5%;
        }
        #about_img4
        {
            margin-left: 5%;
            margin-top: 5%;
            
        }
       
        #about_content
        {
            text-align: center;
            
        }
        
    </style>
    <h1 id="about_content">Jerusalem is totally unique  there is no other place like it. A city of tradition, religion, 
        and history, but also, increasingly, of modern culture and heritage, it is a city with so much
        to offer that you could spend years here and still not see everything</h1>
        <div id="about_images_part1">
        <img src ="source/about1.jpeg" width="600" height= "600" id="about_img1">
        <img src ="source/about2.jpeg" width="600" height= "600" id="about_img2">
        </div>
        <br/>
        <div id="about_images_part2">
            <img src ="source/about3.jpeg" width="600" height= "600" id="about_img3">
            <img src ="source/about4.jpeg" width="600" height= "600" id="about_img4">
        </div>

        <script type="text/javascript">
            
            function addAboutPhotos()
                {
                    var selection1 = document.getElementById("about_images_part1");
                    var about_containers = [];
                    var container1 = addCustomImage("source/about1.jpeg",600,500,selection1,"about_img1");
                    var container2 = addCustomImage("source/about2.jpeg",600,500,selection1,"about_img2");
                    var selection2 = document.getElementById("about_images_part2");
                    var container3 = addCustomImage("source/about3.jpeg",600,500,selection2,"about_img3");
                    var container4 = addCustomImage("source/about4.jpeg",600,500,selection2,"about_img4");
                    about_containers.push(container1);
                    about_containers.push(container2);
                    about_containers.push(container3);
                    about_containers.push(container4);
                    
                    section_containers.push(about_containers);
                    //container1.style.marginLeft = "31.75%";
                    container1.style.cssFloat = "left";
                    container1.style.marginLeft = "13%";

                    container2.style.cssFloat = "left";
                    container2.style.marginLeft = "5%";

                    container3.style.cssFloat = "left";
                    container3.style.marginLeft = "13%";
                    container3.style.marginTop = "5%";

                    container4.style.cssFloat = "left";
                    container4.style.marginLeft = "5%";
                    container4.style.marginTop = "5%";
 
                    setImagesOnClick();
                }
        </script>
</section>
<section id="restorePassword" ng-controller = "restoreCtrl">
<style>
    #div_restore
    {
        position:fixed;
        top: 35%;
        left: 30%;
    }
</style>
    <div class="userdiv" id="div_restore">
        <h1 class="sign_up_labels">Restore Password</h1>
        
        <label class="sign_up_labels">Enter username</label>
        <input class="inptUser" type="text"  placeholder="Username" class="sign_up_labels" id="username_input_restore">
        <label class="sign_up_labels" id="choose_Question_lbl" hidden="true">Choose security question:</label>
        <br/>
        <select id="select_question" class="inptUser" hidden="true">
           
        </select>
        <br/>
        <label for="answer_restore" class="sign_up_labels" id="answer_restore_lbl" hidden="true">Answer</label>
        <br/>
        <input class="inptUser" type="text" id="answer_restore" placeholder="Input Answer" class="sign_up_labels" hidden="true">
        <br/>
        <label id = "errors_restore" class="errorMessages">{{error}}</label>
        <br/>
        <br/>
        <br/>

       <input class="btn" type="submit" id="submit_restore_btn" value="Enter Username" onclick="restore()">



    </div>
    <script type="text/javascript">
    
        
        function restore()
        {
            var button = document.getElementById("submit_restore_btn");
            var username = document.getElementById("username_input_restore");

            var questionLbl = document.getElementById("choose_Question_lbl");
            var question = document.getElementById("select_question");
            var answerLbl = document.getElementById("answer_restore_lbl");
            var answer = document.getElementById("answer_restore");
            var usernameVal = username.value; 
            if(button.value === "Enter Username")
            {
                questionLbl.hidden = false;
                question.hidden = false;
                answerLbl.hidden = false;
                answer.hidden = false;
                
                //ask server for questions
                
                angular.element(document.getElementById('restorePassword')).scope().getQuestions(usernameVal);
                
                button.value="Submit";
            }
            else
            {
                /* reset
             
                */
                
                var questionUser = question.options[question.selectedIndex].text;  
                var answerVal = answer.value;
                

            
            
            angular.element(document.getElementById('restorePassword')).scope().checkAnswer(usernameVal,questionUser,answerVal);
            
            
            }
            
        }
        function resetRestore()
        {
            var button = document.getElementById("submit_restore_btn");
            var questionLbl = document.getElementById("choose_Question_lbl");
            var question = document.getElementById("select_question");
            var answerLbl = document.getElementById("answer_restore_lbl");
            var answer = document.getElementById("answer_restore");
            var username = document.getElementById("username_input_restore");
            username.value ="";
            answer.value = "";
            questionLbl.hidden = true;
                question.hidden = true;
                answerLbl.hidden = true;
                answer.hidden = true;
                button.value="Enter Username";
            document.getElementById("errors_restore").hidden = true;
        }
    </script>
    
  
    
    
</section>
<section id="modalSection">
    <div id="myModal" class="modal-content" ng-controller = "modalCtrl">
        <span class="close">&times;</span>
        <H1 id="modalComment">comment</H1>
        <textarea style="resize:none" id="text" cols="50" rows="5" ></textarea>
        <H1>rating</H1>
        <select id= numbers>
            <option value="num1">1</option>
            <option value="num2">2</option>
            <option value="num3">3</option>
            <option value="num4">4</option>
            <option value="num5">5</option>
        </select>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <input class="btn" type="button" id="commit_btn2" value="commit" onclick="extractData()">
    </div>
    <script type="text/javascript">
    function resetModal()
    {
        var e = document.getElementById("numbers");
        e.selectedIndex = 0;

        document.getElementById("text").value = "";
        
    }
    </script>
</section>
